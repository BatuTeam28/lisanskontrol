<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BatuTycoon ‚Äì Test S√ºr√ºm√º</title>
    <!-- Tailwind CSS CDN for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* CSS stilleri √∂nceki versiyon ile aynƒ±dƒ±r */
        :root {
            --primary-dark: #0a0a0a; 
            --secondary-dark: #1a1a1a;
            --accent-yellow: #f59e0b;
            --shadow-gold: 0 0 25px rgba(251, 191, 36, 0.9);
            --rainbow-bg: #1f2937;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-dark);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 480px; 
            background-color: var(--secondary-dark);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            min-height: 100vh; 
            padding: 0;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            transition: all 0.5s ease-in-out; 
        }
        
        @media (min-width: 640px) {
            body { align-items: center; padding: 20px; }
            #game-container {
                min-height: 90vh;
                border-radius: 1.5rem;
                margin: 20px 0;
            }
        }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background-color: #262626;
            padding: 24px; border-radius: 16px; width: 100%; max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        }

        .game-button {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(145deg, #fcd34d, var(--accent-yellow));
            color: #1f2937;
            font-weight: 800;
            box-shadow: 0 4px 0 #d97706, var(--shadow-gold);
            min-height: 48px; 
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3);
        }
        .game-button:hover, .game-button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d97706, 0 0 40px rgba(251, 191, 36, 1);
        }
        .game-button:active {
            box-shadow: 0 2px 0 #d97706;
            transform: translateY(2px);
        }
        .game-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: 0 4px 0 #4b5563;
            background: #4b5563;
            color: #a1a1a1;
            transform: none;
            text-shadow: none;
        }

        /* --- RAINBOW STYLES --- */
        @keyframes rainbow-text {
            0% { color: #ff0000; } 14% { color: #ff8000; } 28% { color: #ffff00; } 
            42% { color: #00ff00; } 56% { color: #0000ff; } 70% { color: #4b0082; } 
            84% { color: #9400d3; } 100% { color: #ff0000; }
        }
        .rainbow-text {
            animation: rainbow-text 3s linear infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7); 
        }

        @keyframes rainbow-border {
            0% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; } 
            14% { border-color: #ff8000; box-shadow: 0 0 15px #ff8000; }
            28% { border-color: #ffff00; box-shadow: 0 0 15px #ffff00; } 
            42% { border-color: #00ff00; box-shadow: 0 0 15px #00ff00; }
            56% { border-color: #0000ff; box-shadow: 0 0 15px #0000ff; }
            70% { border-color: #4b0082; box-shadow: 0 0 15px #4b0082; }
            84% { border-color: #9400d3; box-shadow: 0 0 15px #9400d3; }
            100% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; }
        }
        .rainbow-border {
            border: 3px solid;
            animation: rainbow-border 4s linear infinite;
        }
        
        .market-item {
            background-color: #262626;
            transition: all 0.2s;
            border-left: 5px solid #f59e0b;
        }
        .market-item.purchased {
            border-left: 5px solid #10b981; 
            background-color: #1f2937;
            opacity: 0.7;
        }
        .market-item:not(.purchased):hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        
    </style>
</head>
<body>

    <!-- Ana Oyun Konteyneri -->
    <div id="game-container" class="shadow-2xl">
        
        <!-- Y√ºkleniyor Ekranƒ± -->
        <div id="loading-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-50">
            <div class="text-4xl font-black text-yellow-500 animate-pulse">BatuTycoon</div>
            <p class="mt-4 text-gray-400">Veriler Y√ºkleniyor...</p>
        </div>

        <!-- Kullanƒ±cƒ± Adƒ± Giri≈üi -->
        <div id="username-screen" class="modal-overlay z-40">
             <div class="modal-content text-center">
                <h2 class="text-4xl font-black text-yellow-500 mb-6">BatuTycoon Giri≈ü</h2>
                <p class="text-gray-300 mb-4 text-center">L√ºtfen kalƒ±cƒ± bir kullanƒ±cƒ± adƒ± belirleyin.</p>
                <input type="text" id="username-input" placeholder="Oyuncu Adƒ±nƒ±z..." class="w-full p-4 mb-6 rounded-xl bg-gray-700 border border-gray-600 text-white text-lg focus:outline-none focus:ring-4 focus:ring-yellow-500 shadow-inner">
                <button id="start-game-button" class="game-button w-full p-4 rounded-xl text-xl">Oyuna Ba≈üla</button>
            </div>
        </div>

        <!-- Ba≈ülƒ±k ve ƒ∞statistikler -->
        <header id="game-header" class="p-4 flex flex-col items-center bg-gray-800/90 rounded-t-xl sticky top-0 z-30 shadow-2xl transition-all duration-500">
            <h1 id="main-title" class="text-4xl font-black text-yellow-400 mb-1 transition-colors duration-500">BatuTycoon</h1>
            <div class="text-xs text-gray-400 mb-3 flex items-center">
                <span id="rainbow-status-indicator" class="mr-2 text-xl hidden">üåà</span>
                <span>BatuTycoonTest (Verision V1)</span>
            </div>
            <div class="w-full flex justify-between items-center text-lg font-bold">
                <div class="flex flex-col items-start">
                    <span id="player-username" class="text-sm text-gray-300 truncate w-24">Kullanƒ±cƒ±: Y√ºkleniyor</span>
                    <span class="text-xl text-green-400">Level: <span id="player-level">1</span></span>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-sm text-gray-300">Kazan√ß/sn (GPS): <span id="gps-display">0</span></span>
                    <span id="money-display-wrapper" class="text-4xl font-extrabold text-yellow-500 text-shadow-lg transition-colors duration-500">
                        <span id="money-display">0</span> üí∞
                    </span>
                </div>
            </div>
        </header>

        <!-- Madencilik Alanƒ± -->
        <div id="miner-area" class="h-64 flex flex-col justify-center p-4">
            <div class="text-center">
                <div class="text-5xl mb-4">‚õèÔ∏è</div>
                <p class="text-xl text-yellow-300 font-bold">Kazan√ß √áarpanƒ±: <span id="total-multiplier">x1.00</span></p>
                <p class="text-md text-gray-400">Derinlik: <span id="depth-level">1</span> | Madenci: <span id="miner-count-level">1</span></p>
            </div>
        </div>

        <!-- Y√ºkseltme Paneli ve Pazar/D√ºkkan -->
        <div class="p-4">
            
            <!-- Sekmeler -->
            <div class="flex mb-4 space-x-2 border-b border-gray-700">
                <button data-tab="upgrades" class="tab-button text-lg px-4 py-2 font-bold rounded-t-lg bg-yellow-600 text-white shadow-lg">Geli≈ütirmeler</button>
                <button data-tab="market" class="tab-button text-lg px-4 py-2 font-bold rounded-t-lg bg-gray-700 text-gray-300">Pazar/D√ºkkan</button>
            </div>
            
            <!-- 1. Geli≈ütirmeler Sekmesi -->
            <div id="upgrades-tab" class="tab-content">
                <h2 class="text-2xl font-black text-yellow-300 mb-4 pb-2">Temel Geli≈ütirmeler</h2>
                
                <div class="grid grid-cols-1 gap-4">
                    <!-- Hƒ±z -->
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">‚õèÔ∏è Madenci Hƒ±zƒ±</span>
                            <span id="speed-level-display" class="text-xs text-gray-300">Seviye: 1 (√áarpan: x1.00)</span>
                        </div>
                        <button id="upgrade-speed-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="speed-cost">100</span> üí∞ Y√ºkselt
                        </button>
                    </div>

                    <!-- Sayƒ± -->
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">üë∑ Madenci Sayƒ±sƒ±</span>
                            <span id="count-level-display" class="text-xs text-gray-300">Seviye: 1 (Madenci: 1)</span>
                        </div>
                        <button id="upgrade-count-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="count-cost">200</span> üí∞ Y√ºkselt
                        </button>
                    </div>
                    
                    <!-- Derinlik -->
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">V Maden Derinliƒüi</span>
                            <span id="depth-level-display" class="text-xs text-gray-300">Seviye: 1 (Taban Kazan√ß +%0)</span>
                        </div>
                        <button id="upgrade-depth-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="depth-cost">500</span> üí∞ Y√ºkselt
                        </button>
                    </div>
                    
                    <!-- Kapasite -->
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">‚¨ÜÔ∏è Asans√∂r Kapasitesi</span>
                            <span id="capacity-level-display" class="text-xs text-gray-300">Seviye: 1 (Kapasite: x1.00)</span>
                        </div>
                        <button id="upgrade-capacity-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="capacity-cost">750</span> üí∞ Y√ºkselt
                        </button>
                    </div>
                </div>

                <!-- Level Up Butonu -->
                <div class="mt-6">
                    <button id="level-up-button" class="game-button w-full p-4 rounded-xl text-xl">
                        Level Y√ºkselt (Maliyet: <span id="level-cost">1000</span> üí∞)
                    </button>
                </div>
            </div>
            
            <!-- 2. Pazar/D√ºkkan Sekmesi -->
            <div id="market-tab" class="tab-content hidden">
                <h2 class="text-2xl font-black text-yellow-300 mb-4 pb-2">Pazar/D√ºkkan (Kalƒ±cƒ± √áarpanlar)</h2>
                <div id="market-items-list" class="space-y-3">
                    <!-- Dinamik olarak doldurulacak -->
                    <p class="text-gray-400 text-center py-4">√ñƒüeler y√ºkleniyor...</p>
                </div>
            </div>
        </div>

        <!-- Alt Uyarƒ± ve Admin Butonu -->
        <div class="sticky bottom-0 left-0 right-0 p-4 bg-gray-800/90 border-t border-gray-700 shadow-inner z-20">
            <p id="message-box" class="text-center text-sm text-red-400 mb-2"></p>
            <button id="admin-button" class="text-xs text-gray-500 hover:text-red-500 transition duration-150 w-full text-center">Yapƒ±mcƒ± :) Batu</button>
        </div>
    </div>

    <!-- Offline Kazan√ß Modalƒ± -->
    <div id="offline-modal" class="modal-overlay">
        <div class="modal-content text-center">
            <h3 class="text-3xl font-black text-yellow-500 mb-4">Ho≈ü Geldiniz!</h3>
            <p class="text-lg text-gray-300 mb-4">√áevrimdƒ±≈üƒ± kazancƒ±nƒ±z:</p>
            <p class="text-4xl font-extrabold text-green-400 mb-6">
                <span id="offline-money-display">0</span> üí∞
            </p>
            <button id="close-offline-modal" class="game-button px-8 py-3 rounded-lg text-xl">Harika!</button>
        </div>
    </div>

    <!-- Admin Panel Modalƒ± -->
    <div id="admin-modal" class="modal-overlay">
        <div class="modal-content" id="admin-modal-content">
            <h3 class="text-2xl font-bold text-red-400 mb-4 border-b-2 border-red-700 pb-2">‚öîÔ∏èAdmin Paneli</h3>
            
            <div id="admin-login" class="mb-4">
                <p class="text-gray-300 mb-2">L√ºtfen ≈üifreyi girin:</p>
                <input type="password" id="admin-password-input" placeholder="≈ûifre" class="w-full p-3 mb-4 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                <button id="admin-login-button" class="game-button w-full p-3 bg-red-600 hover:bg-red-500 text-white shadow-none">Giri≈ü Yap</button>
            </div>
            
            <div id="admin-controls" class="hidden">
                <p class="text-sm text-gray-400 mb-4">Oturum Tipi: <span class="text-yellow-400 font-bold">Yapƒ±mcƒ± :) Batu</span></p>
                
                <!-- RAINBOW CHEAT CODE INPUT -->
                <div class="mb-6 border-t border-gray-600 pt-4">
                    <h4 class="text-xl font-bold text-yellow-400 mb-2">Kod Gir </h4>
                    <p class="text-xs text-gray-500 mb-2">Kodlar : BatuEffect~BatuHizli~BatuMaxla~BatuZengin~BatuTycoonTest</p>
                    <input type="text" id="cheat-code-input" placeholder="Kodu Gir..." class="w-full p-3 mb-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 uppercase">
                    <button id="apply-cheat-button" class="game-button w-full p-3 bg-yellow-600 hover:bg-yellow-500 text-white shadow-none">Kodu Uygula</button>
                </div>
                
                <!-- Dƒ∞REKT CHEAT BUTONLARI -->
                <button id="admin-cheat-money" class="game-button w-full p-3 mb-3 bg-green-600 hover:bg-green-500 text-white shadow-none">100 Milyon üí∞ Ekle</button>
                <button id="admin-cheat-max-all" class="game-button w-full p-3 mb-3 bg-purple-600 hover:bg-purple-500 text-white shadow-none">Max Level & T√ºm Geli≈ütirmeler</button>
                <button id="admin-cheat-unlock-market" class="game-button w-full p-3 mb-3 bg-blue-600 hover:bg-blue-500 text-white shadow-none">T√ºm Pazar √ñƒüelerini Al</button>
                <button id="admin-reset-data" class="game-button w-full p-3 mb-4 bg-gray-600 hover:bg-gray-500 text-white shadow-none">Verileri TAMAMEN Sƒ±fƒ±rla</button>
                <button id="admin-close" class="game-button w-full p-3 bg-red-400 hover:bg-red-300 text-white shadow-none">Paneli Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // --- Game Variables ---
        let gameLoopInterval = null;

        const ADMIN_PASSWORD = "BatuTycoon";
        const LOCAL_STORAGE_KEY = 'batu_tycoon_data';

        // Game State (Default Values)
        let game = {
            username: '',
            money: 0,
            level: 1,
            speedLevel: 1,
            minerCountLevel: 1,
            shaftDepthLevel: 1,
            elevatorCapacityLevel: 1,
            lastSaveTime: Date.now(),
            isRainbowMode: false,
            purchases: {},
        };

        // --- Market Items (Aynƒ± kaldƒ±) ---
        const MARKET_ITEMS = [
            { key: 'M01', name: 'Micro Yatƒ±rƒ±mcƒ±', cost: 10000, multiplier: 1.05, category: 'Yatƒ±rƒ±m', icon: 'üìà' },
            { key: 'M02', name: 'Kripto Fonu', cost: 50000, multiplier: 1.10, category: 'Yatƒ±rƒ±m', icon: '‚Çø' },
            { key: 'M03', name: 'Gayrimenkul ƒ∞mparatoru', cost: 250000, multiplier: 1.15, category: 'Yatƒ±rƒ±m', icon: 'üè†' },
            { key: 'M04', name: 'Borsa Sihirbazƒ±', cost: 1000000, multiplier: 1.20, category: 'Yatƒ±rƒ±m', icon: 'üìä' },
            { key: 'M05', name: 'Gelecek S√∂zle≈ümesi', cost: 5000000, multiplier: 1.25, category: 'Yatƒ±rƒ±m', icon: 'üìú' },
            
            { key: 'T06', name: 'Geli≈ümi≈ü Sondaj Ucu', cost: 15000, multiplier: 1.07, category: 'Teknoloji', icon: 'üî©' },
            { key: 'T07', name: 'Titanyum Kovalar', cost: 75000, multiplier: 1.12, category: 'Teknoloji', icon: 'ü™£' },
            { key: 'T08', name: 'Yapay Zeka Navigasyon', cost: 300000, multiplier: 1.18, category: 'Teknoloji', icon: 'ü§ñ' },
            { key: 'T09', name: 'Anti-Yer√ßekimi Ta≈üƒ±yƒ±cƒ±', cost: 1200000, multiplier: 1.22, category: 'Teknoloji', icon: 'üõ∏' },
            { key: 'T10', name: 'N√ºkleer Enerji Santrali', cost: 6000000, multiplier: 1.30, category: 'Teknoloji', icon: '‚öõÔ∏è' },
            
            { key: 'P11', name: 'Uzman Jeolog', cost: 20000, multiplier: 1.06, category: 'Personel', icon: 'üî¨' },
            { key: 'P12', name: 'G√ºvenlik Takƒ±mƒ±', cost: 90000, multiplier: 1.11, category: 'Personel', icon: 'üõ°Ô∏è' },
            { key: 'P13', name: 'Liderlik Eƒüitimi', cost: 400000, multiplier: 1.16, category: 'Personel', icon: 'üéì' },
            { key: 'P14', name: 'S√ºperviz√∂r Robot', cost: 1500000, multiplier: 1.21, category: 'Personel', icon: '‚öôÔ∏è' },
            { key: 'P15', name: 'Y√∂netim Merkezi', cost: 7000000, multiplier: 1.27, category: 'Personel', icon: 'üèõÔ∏è' },
            
            { key: 'L16', name: 'Geni≈ületilmi≈ü Depo', cost: 30000, multiplier: 1.08, category: 'Altyapƒ±', icon: 'üì¶' },
            { key: 'L17', name: 'Hƒ±zlƒ± Tren Lojistik', cost: 110000, multiplier: 1.13, category: 'Altyapƒ±', icon: 'üöÜ' },
            { key: 'L18', name: 'Otomasyon Hattƒ±', cost: 500000, multiplier: 1.19, category: 'Altyapƒ±', icon: '‚õìÔ∏è' },
            { key: 'L19', name: 'Uydu ƒ∞zleme', cost: 2000000, multiplier: 1.23, category: 'Altyapƒ±', icon: 'üõ∞Ô∏è' },
            { key: 'L20', name: 'Uzay Limanƒ±', cost: 10000000, multiplier: 1.35, category: 'Altyapƒ±', icon: 'üöÄ' },

            { key: 'C21', name: 'Altƒ±n Kaplama Kazma', cost: 40000, multiplier: 1.04, category: 'Prestij', icon: 'ü•á' },
            { key: 'C22', name: '√ñzel Logolu Kask', cost: 150000, multiplier: 1.05, category: 'Prestij', icon: '‚≠ê' },
            { key: 'C23', name: 'Madenci Heykeli', cost: 600000, multiplier: 1.06, category: 'Prestij', icon: 'üóø' },
            { key: 'C24', name: 'B√∂lgesel Sponsorluk', cost: 2500000, multiplier: 1.07, category: 'Prestij', icon: 'üì∞' },
            { key: 'C25', name: 'D√ºnya Merkezi', cost: 12000000, multiplier: 1.08, category: 'Prestij', icon: 'üåç' },
            
            { key: 'B26', name: 'Mega Verimlilik ≈ûemasƒ±', cost: 15000000, multiplier: 1.50, category: 'Bonus', icon: '‚ú®' },
            { key: 'B27', name: 'Kara Delik Sim√ºlat√∂r√º', cost: 30000000, multiplier: 1.75, category: 'Bonus', icon: '‚ö´' },
            
            { key: 'E28', name: 'Batu\'nun ≈ûans Tƒ±lsƒ±mƒ±', cost: 50000000, multiplier: 2.00, category: '√ñzel', icon: 'üçÄ' },
            { key: 'E29', name: 'Sonsuz Enerji Pili', cost: 100000000, multiplier: 2.50, category: '√ñzel', icon: 'üîã' },
            { key: 'E30', name: 'Zaman B√ºk√ºc√º', cost: 200000000, multiplier: 3.00, category: '√ñzel', icon: '‚è≥' },
            { key: 'E31', name: 'Anti-Kriz Sigortasƒ±', cost: 300000000, multiplier: 3.50, category: '√ñzel', icon: 'üõ°Ô∏è' },
            { key: 'E32', name: 'Kainatƒ±n Anahtarƒ±', cost: 500000000, multiplier: 4.00, category: '√ñzel', icon: 'üîë' },
            { key: 'E33', name: 'G√∂kku≈üaƒüƒ± Patlamasƒ±', cost: 750000000, multiplier: 5.00, category: '√ñzel', icon: 'üåà' },
            { key: 'E34', name: 'Evrensel Kaynak', cost: 1000000000, multiplier: 10.00, category: '√ñzel', icon: 'üåå' },
        ];


        // Constants and Cost Calculation Functions (Aynƒ± kaldƒ±)
        const BASE_RATE = 10;
        const MAX_LEVEL = 500; 
        const MAX_UPGRADE_LEVEL = 1000; 
        const RAINBOW_CODES = {
            "BatuEffect": { effect: "toggle_rainbow", message: "G√∂kku≈üaƒüƒ± Efekti A√ßƒ±ldƒ±/Kapandƒ±!", fn: () => { game.isRainbowMode = !game.isRainbowMode; updateRainbowEffect(); } },
            "BatuHizli": { effect: "speed_max", message: `Madenci Hƒ±zƒ± MAX (${MAX_UPGRADE_LEVEL}) yapƒ±ldƒ±!`, fn: () => { game.speedLevel = MAX_UPGRADE_LEVEL; } },
            "BatuZengin": { effect: "add_1B", message: "1 Milyar (1G) Para Eklendi!", fn: () => { game.money += 1000000000; } },
            "BatuTycoonTest": { effect: "max_all", message: `T√ºm Temel Geli≈ütirmeler MAX yapƒ±ldƒ±!`, fn: () => { game.speedLevel = MAX_UPGRADE_LEVEL; game.minerCountLevel = MAX_UPGRADE_LEVEL; game.shaftDepthLevel = MAX_UPGRADE_LEVEL; game.elevatorCapacityLevel = MAX_UPGRADE_LEVEL; } },
            "BatuMaxla": { effect: "unlock_market", message: "T√ºm Pazar √ñƒüeleri √úcretsiz Alƒ±ndƒ±!", fn: () => { MARKET_ITEMS.forEach(item => { game.purchases[item.key] = true; }); } }
        };

        const getSpeedCost = (level) => Math.floor(100 * (1.5 ** (level - 1)));
        const getCountCost = (level) => Math.floor(200 * (1.6 ** (level - 1)));
        const getDepthCost = (level) => Math.floor(500 * (1.7 ** (level - 1)));
        const getCapacityCost = (level) => Math.floor(750 * (1.8 ** (level - 1)));
        const getLevelCost = (level) => Math.floor(1000 * (1.9 ** (level - 1)));

        // --- LocalStorage Persistence Functions ---

        /**
         * Loads game data from localStorage.
         * @returns {boolean} True if data was found and loaded, false otherwise.
         */
        function loadGameData() {
            // Veriyi localStorage'dan √ßek
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            
            document.getElementById('loading-screen').classList.add('hidden');

            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    
                    // Verileri y√ºkle ve varsayƒ±lan deƒüerleri saƒüla
                    game.username = parsedData.username || '';
                    game.money = parsedData.money || 0;
                    game.level = Math.min(parsedData.level || 1, MAX_LEVEL); 
                    game.speedLevel = Math.min(parsedData.speedLevel || 1, MAX_UPGRADE_LEVEL);
                    game.minerCountLevel = Math.min(parsedData.minerCountLevel || 1, MAX_UPGRADE_LEVEL);
                    game.shaftDepthLevel = Math.min(parsedData.shaftDepthLevel || 1, MAX_UPGRADE_LEVEL);
                    game.elevatorCapacityLevel = Math.min(parsedData.elevatorCapacityLevel || 1, MAX_UPGRADE_LEVEL);
                    game.isRainbowMode = parsedData.isRainbowMode || false; 
                    game.purchases = parsedData.purchases || {}; 
                    
                    // √áevrimdƒ±≈üƒ± kazancƒ± hesapla
                    const savedTime = parsedData.lastSaveTime || Date.now();
                    calculateOfflineEarning(savedTime);
                    
                    return true; // Veri bulundu
                } catch (e) {
                    console.error("localStorage verisi √ß√∂z√ºmlenirken hata:", e);
                    // Veri bozuksa sƒ±fƒ±rdan ba≈üla
                    return false;
                }
            }
            return false; // Veri bulunamadƒ±
        }

        /**
         * Saves current game state to localStorage.
         */
        function saveGameData() {
            game.lastSaveTime = Date.now();
            try {
                // Oyunu JSON string'ine √ßevirip kaydet
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(game));
            } catch (error) {
                console.error("Veri localStorage'a kaydedilirken hata:", error);
                showMessage("Kayƒ±t hatasƒ±! Tarayƒ±cƒ±nƒ±z dolu olabilir.", 'red');
            }
        }
        
        // --- Game Flow ---

        function checkUsernameAndStart() {
            // Veri y√ºklenmediyse ve kullanƒ±cƒ± adƒ± yoksa giri≈ü ekranƒ±nƒ± g√∂ster
            if (!game.username) {
                document.getElementById('username-screen').style.display = 'flex'; 
            } else {
                // Kullanƒ±cƒ± adƒ± varsa oyunu ba≈ülat
                startGame();
            }
        }

        function startGame() {
            document.getElementById('username-screen').style.display = 'none'; 
            
            // Aray√ºz√º ayarla ve oyun d√∂ng√ºs√ºn√º ba≈ülat
            setupTabs();
            renderMarketItems();
            updateRainbowEffect();
            updateUI();
            
            // √ñnceki d√∂ng√ºy√º temizle ve yenisini ba≈ülat
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 1000); 

            // D√ºzenli kaydetme (her 15 saniyede bir)
            setInterval(saveGameData, 15000); 
        }
        
        // --- Game Mechanics (Aynƒ± kaldƒ±) ---
        
        function performUpgrade(costFunc, levelKey, name, maxLevel) {
            const currentLevel = game[levelKey];
            if (currentLevel >= maxLevel) {
                showMessage(`Maksimum ${name} seviyesine ula≈üƒ±ldƒ±.`, 'yellow');
                return;
            }
            const cost = costFunc(currentLevel);

            if (game.money >= cost) {
                game.money -= cost;
                game[levelKey]++;
                showMessage(`${name} y√ºkseltildi! Seviye: ${game[levelKey]}`, 'green');
            } else {
                showMessage(`Yetersiz Para! ${formatNumber(cost)} üí∞ gerekli.`, 'red');
            }
            updateUI();
            saveGameData(); // LocalStorage'a kaydet
        }


        function calculateGPS() {
            const depthMultiplier = 1 + (0.20 * (game.shaftDepthLevel - 1));
            const baseEarning = BASE_RATE * depthMultiplier;

            const speedMultiplier = 1 + (0.1 * (game.speedLevel - 1));
            const minerCount = game.minerCountLevel;
            const capacityMultiplier = 1 + (0.15 * (game.elevatorCapacityLevel - 1));

            let marketMultiplier = 1.0;
            MARKET_ITEMS.forEach(item => {
                if (game.purchases[item.key]) {
                    marketMultiplier *= item.multiplier;
                }
            });

            const gps = baseEarning * speedMultiplier * minerCount * capacityMultiplier * marketMultiplier;
            
            game.totalMultiplier = marketMultiplier; 
            
            return Math.floor(gps);
        }

        function gameLoop() {
            const gps = calculateGPS();
            game.money += gps;
            updateUI();
        }

        function calculateOfflineEarning(savedTime) {
            const currentTime = Date.now();
            const timeElapsedSeconds = Math.floor((currentTime - savedTime) / 1000);

            if (timeElapsedSeconds > 5) { // Minimum 5 saniye bekleme s√ºresi
                const offlineGPS = calculateGPS(); 
                const offlineEarnings = offlineGPS * timeElapsedSeconds;
                
                game.money += offlineEarnings;

                if (offlineEarnings > 0) {
                    document.getElementById('offline-money-display').textContent = formatNumber(offlineEarnings);
                    document.getElementById('offline-modal').style.display = 'flex';
                }
            }
        }
        
        function buyMarketItem(itemKey) {
            if (game.purchases[itemKey]) {
                showMessage('Bu √∂ƒüeye zaten sahipsiniz!', 'yellow');
                return;
            }

            const item = MARKET_ITEMS.find(i => i.key === itemKey);
            if (!item) return;

            if (game.money >= item.cost) {
                game.money -= item.cost;
                game.purchases[itemKey] = true;
                showMessage(`${item.name} satƒ±n alƒ±ndƒ±! Kazan√ß √ßarpanƒ± arttƒ±.`, 'green');
                updateUI();
                renderMarketItems(); 
                saveGameData(); // LocalStorage'a kaydet
            } else {
                showMessage(`Yetersiz Para! ${formatNumber(item.cost)} üí∞ gerekli.`, 'red');
            }
        }


        // --- UI and Animation Operations (Aynƒ± kaldƒ±) ---

        function formatNumber(num) {
            if (num >= 1e15) return (num / 1e15).toFixed(2) + 'P';
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'G';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return Math.floor(num).toLocaleString('tr-TR');
        }

        function updateUI() {
            const gps = calculateGPS();

            document.getElementById('money-display').textContent = formatNumber(game.money);
            document.getElementById('gps-display').textContent = formatNumber(gps);
            document.getElementById('player-level').textContent = game.level;
            document.getElementById('player-username').textContent = `Kullanƒ±cƒ±: ${game.username || 'Anonim'}`;
            document.getElementById('depth-level').textContent = game.shaftDepthLevel;
            document.getElementById('miner-count-level').textContent = game.minerCountLevel;
            
            const totalMultiplier = MARKET_ITEMS.reduce((total, item) => 
                game.purchases[item.key] ? total * item.multiplier : total, 1.0);
            document.getElementById('total-multiplier').textContent = `x${totalMultiplier.toFixed(2)}`;
            
            updateUpgradeButton('speed', getSpeedCost, game.speedLevel, MAX_UPGRADE_LEVEL, 'speed-level-display', 
                (level) => `Seviye: ${level} (√áarpan: x${(1 + 0.1 * (level - 1)).toFixed(2)})`);
            updateUpgradeButton('count', getCountCost, game.minerCountLevel, MAX_UPGRADE_LEVEL, 'count-level-display', 
                (level) => `Seviye: ${level} (Madenci: ${level})`);
            updateUpgradeButton('depth', getDepthCost, game.shaftDepthLevel, MAX_UPGRADE_LEVEL, 'depth-level-display',
                (level) => `Seviye: ${level} (Taban Kazan√ß +%${((level - 1) * 20)})`);
            updateUpgradeButton('capacity', getCapacityCost, game.elevatorCapacityLevel, MAX_UPGRADE_LEVEL, 'capacity-level-display',
                (level) => `Seviye: ${level} (Kapasite: x${(1 + 0.15 * (level - 1)).toFixed(2)})`);
            
            const levelCost = getLevelCost(game.level);
            const levelBtn = document.getElementById('level-up-button');
            document.getElementById('level-cost').textContent = formatNumber(levelCost);
            levelBtn.disabled = game.money < levelCost || game.level >= MAX_LEVEL;
            levelBtn.innerHTML = game.level >= MAX_LEVEL 
                ? `MAKSƒ∞MUM LEVEL (${MAX_LEVEL})` 
                : `Level Y√ºkselt (Maliyet: <span id="level-cost">${formatNumber(levelCost)}</span> üí∞)`;
            
            updateMarketButtonStates();
        }

        function updateUpgradeButton(name, costFunc, currentLevel, maxLevel, displayId, displayFormatter) {
            const cost = costFunc(currentLevel);
            const btn = document.getElementById(`upgrade-${name}-button`);
            const costSpan = document.getElementById(`${name}-cost`);
            const displaySpan = document.getElementById(displayId);

            displaySpan.textContent = displayFormatter(currentLevel);
            
            if (currentLevel >= maxLevel) {
                btn.disabled = true;
                costSpan.textContent = 'MAX';
                btn.innerHTML = `MAX (${maxLevel})`;
            } else {
                costSpan.textContent = formatNumber(cost);
                btn.disabled = game.money < cost;
            }
        }
        
        function renderMarketItems() {
            const list = document.getElementById('market-items-list');
            list.innerHTML = '';
            
            let currentCategory = '';
            
            MARKET_ITEMS.forEach(item => {
                if (item.category !== currentCategory) {
                    currentCategory = item.category;
                    const header = document.createElement('h3');
                    header.className = 'text-xl font-bold text-gray-200 mt-4 mb-2 border-b border-gray-600 pb-1';
                    header.textContent = `${item.icon} ${item.category}`;
                    list.appendChild(header);
                }

                const isPurchased = game.purchases[item.key];
                const itemDiv = document.createElement('div');
                itemDiv.id = `market-item-${item.key}`;
                itemDiv.className = `market-item p-3 rounded-xl shadow-md flex justify-between items-center ${isPurchased ? 'purchased' : 'bg-gray-800'}`;
                
                itemDiv.innerHTML = `
                    <div>
                        <p class="text-lg font-bold ${isPurchased ? 'text-green-400' : 'text-yellow-300'}">${item.icon} ${item.name}</p>
                        <p class="text-xs text-gray-400">Kalƒ±cƒ± √áarpan: x${item.multiplier.toFixed(2)}</p>
                    </div>
                    <button 
                        data-key="${item.key}"
                        class="market-buy-button game-button p-2 rounded-lg text-sm ml-2 w-24 transition-all duration-150 ${isPurchased ? 'bg-green-600 hover:bg-green-600' : ''}"
                        ${isPurchased ? 'disabled' : ''}
                    >
                        ${isPurchased ? 'ALINDI' : `${formatNumber(item.cost)} üí∞`}
                    </button>
                `;
                
                list.appendChild(itemDiv);
            });
            
            list.querySelectorAll('.market-buy-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const key = e.currentTarget.getAttribute('data-key');
                    buyMarketItem(key);
                });
            });
            
            updateMarketButtonStates(); 
        }
        
        function updateMarketButtonStates() {
            document.querySelectorAll('.market-buy-button').forEach(button => {
                const key = button.getAttribute('data-key');
                const item = MARKET_ITEMS.find(i => i.key === key);
                
                if (game.purchases[key] || !item) {
                    button.disabled = true;
                    button.textContent = 'ALINDI';
                    button.parentElement.classList.add('purchased');
                } else {
                    const canBuy = game.money >= item.cost;
                    button.disabled = !canBuy;
                    button.textContent = `${formatNumber(item.cost)} üí∞`;
                    button.parentElement.classList.remove('purchased');
                }
            });
        }


        function updateRainbowEffect() {
            const container = document.getElementById('game-container');
            const moneyDisplay = document.getElementById('money-display-wrapper');
            const mainTitle = document.getElementById('main-title');
            const indicator = document.getElementById('rainbow-status-indicator');
            const header = document.getElementById('game-header');
            const adminModal = document.getElementById('admin-modal-content');
            
            if (game.isRainbowMode) {
                moneyDisplay.classList.add('rainbow-text');
                mainTitle.classList.add('rainbow-text');
                indicator.classList.remove('hidden');
                header.classList.add('rainbow-border');
                adminModal.classList.add('rainbow-border');
                container.style.backgroundColor = 'var(--rainbow-bg)'; 
            } else {
                moneyDisplay.classList.remove('rainbow-text');
                mainTitle.classList.remove('rainbow-text');
                indicator.classList.add('hidden');
                header.classList.remove('rainbow-border');
                adminModal.classList.remove('rainbow-border');
                container.style.backgroundColor = 'var(--secondary-dark)';
            }
        }

        function showMessage(msg, color) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = msg;
            msgBox.className = `text-center text-sm mb-2 text-${color}-400 font-semibold animate-pulse`; 
            setTimeout(() => {
                msgBox.textContent = '';
                msgBox.className = `text-center text-sm mb-2 text-red-400`;
            }, 2500);
        }
        
        // --- Admin Panel (Aynƒ± kaldƒ±) ---
        function showAdminModal() {
            document.getElementById('admin-modal').style.display = 'flex';
            document.getElementById('admin-password-input').value = '';
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-controls').classList.add('hidden');
            document.getElementById('cheat-code-input').value = ''; 
        }

        function adminLogin() {
            const password = document.getElementById('admin-password-input').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-controls').classList.remove('hidden');
                showMessage("Admin Giri≈üi Ba≈üarƒ±lƒ±!", 'green');
            } else {
                showMessage("Admin ≈ûifresi Yanlƒ±≈ü!", 'red');
                document.getElementById('admin-password-input').value = '';
            }
        }

        function adminCheatMoney() {
            game.money += 100000000; 
            updateUI();
            saveGameData();
            showMessage("100M Para Eklendi!", 'green');
        }

        function adminCheatMaxAll() {
            game.level = MAX_LEVEL;
            game.speedLevel = MAX_UPGRADE_LEVEL;
            game.minerCountLevel = MAX_UPGRADE_LEVEL;
            game.shaftDepthLevel = MAX_UPGRADE_LEVEL;
            game.elevatorCapacityLevel = MAX_UPGRADE_LEVEL;
            updateUI();
            saveGameData();
            showMessage(`Temel Geli≈ütirmeler MAX'landƒ±!`, 'green');
        }
        
        function adminCheatUnlockMarket() {
            MARKET_ITEMS.forEach(item => {
                game.purchases[item.key] = true;
            });
            updateUI();
            renderMarketItems();
            saveGameData();
            showMessage("T√ºm Pazar √ñƒüeleri Alƒ±ndƒ±!", 'green');
        }

        function adminResetData() {
            // Note: Since we cannot use confirm/alert, we use a prompt as a stand-in confirmation
            const confirmation = prompt('T√úM VERƒ∞LERƒ∞ SIFIRLAMAK ƒ∞√áƒ∞N "Sƒ±fƒ±rla" yazƒ±n. (Kullanƒ±cƒ± adƒ± hari√ß)');
            if (confirmation !== 'Sƒ±fƒ±rla') {
                showMessage('Sƒ±fƒ±rlama iptal edildi.', 'yellow');
                return;
            }
            
            // Veri sƒ±fƒ±rlama
            game = {
                username: game.username, // Kullanƒ±cƒ± adƒ±nƒ± koru
                money: 0,
                level: 1,
                speedLevel: 1,
                minerCountLevel: 1,
                shaftDepthLevel: 1,
                elevatorCapacityLevel: 1,
                lastSaveTime: Date.now(),
                isRainbowMode: false,
                purchases: {}, 
            };
            
            // LocalStorage'dan tamamen sil
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            
            updateRainbowEffect();
            saveGameData();
            
            document.getElementById('admin-modal').style.display = 'none';
            updateUI();
            renderMarketItems();
            showMessage("Veriler Sƒ±fƒ±rlandƒ±! Yeni bir ba≈ülangƒ±√ß yapƒ±ldƒ±.", 'red');
        }
        
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    tabButtons.forEach(btn => {
                        btn.classList.remove('bg-yellow-600', 'text-white');
                        btn.classList.add('bg-gray-700', 'text-gray-300');
                    });
                    button.classList.add('bg-yellow-600', 'text-white');
                    button.classList.remove('bg-gray-700', 'text-gray-300');

                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
                });
            });
        }


        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // Veriyi y√ºkle ve kullanƒ±cƒ± adƒ± kontrol√º yap
            loadGameData();
            checkUsernameAndStart();
            
            // Kullanƒ±cƒ± Adƒ± Giri≈üi
            document.getElementById('start-game-button').addEventListener('click', () => {
                const username = document.getElementById('username-input').value.trim();
                if (username.length > 2 && username.length < 20) {
                    game.username = username;
                    saveGameData();
                    startGame();
                } else {
                    showMessage("Kullanƒ±cƒ± adƒ± 3-20 karakter arasƒ±nda olmalƒ±.", 'red');
                }
            });

            // Y√ºkseltme Butonlarƒ±
            document.getElementById('upgrade-speed-button').addEventListener('click', () => 
                performUpgrade(getSpeedCost, 'speedLevel', 'Madenci Hƒ±zƒ±', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-count-button').addEventListener('click', () => 
                performUpgrade(getCountCost, 'minerCountLevel', 'Madenci Sayƒ±sƒ±', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-depth-button').addEventListener('click', () => 
                performUpgrade(getDepthCost, 'shaftDepthLevel', 'Maden Derinliƒüi', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-capacity-button').addEventListener('click', () => 
                performUpgrade(getCapacityCost, 'elevatorCapacityLevel', 'Asans√∂r Kapasitesi', MAX_UPGRADE_LEVEL));
            document.getElementById('level-up-button').addEventListener('click', () => 
                performUpgrade(getLevelCost, 'level', 'Level', MAX_LEVEL));
            
            // √áevrimdƒ±≈üƒ± Modal Kapatma
            document.getElementById('close-offline-modal').addEventListener('click', () => {
                document.getElementById('offline-modal').style.display = 'none';
            });

            // Admin Butonlarƒ±
            document.getElementById('admin-button').addEventListener('click', showAdminModal);
            document.getElementById('admin-login-button').addEventListener('click', adminLogin);
            
            document.getElementById('apply-cheat-button').addEventListener('click', () => {
                const code = document.getElementById('cheat-code-input').value.trim().toUpperCase();
                const cheat = RAINBOW_CODES[code];
                if (cheat) {
                    cheat.fn();
                    showMessage(`[Hile Aktif] ${cheat.message}`, 'yellow');
                } else {
                    showMessage(`Hile Kodu Ge√ßersiz!`, 'red');
                }
                document.getElementById('cheat-code-input').value = '';
                updateUI();
                renderMarketItems(); 
                saveGameData();
            });
            
            document.getElementById('cheat-code-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('apply-cheat-button').click();
                }
            });

            document.getElementById('admin-cheat-money').addEventListener('click', adminCheatMoney);
            document.getElementById('admin-cheat-max-all').addEventListener('click', adminCheatMaxAll);
            document.getElementById('admin-cheat-unlock-market').addEventListener('click', adminCheatUnlockMarket);
            document.getElementById('admin-reset-data').addEventListener('click', adminResetData);
            document.getElementById('admin-close').addEventListener('click', () => {
                document.getElementById('admin-modal').style.display = 'none';
            });
        });
    </script>
</body>
</html>

