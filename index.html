<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BatuTycoon â€“ (Test Version V1)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* CSS stilleri */
        :root {
            --primary-dark: #0a0a0a; 
            --secondary-dark: #1a1a1a;
            --accent-yellow: #f59e0b;
            --shadow-gold: 0 0 25px rgba(251, 191, 36, 0.9);
            --rainbow-bg: #1f2937;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-dark);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 480px; 
            background-color: var(--secondary-dark);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            min-height: 100vh; 
            padding: 0;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            transition: all 0.5s ease-in-out; 
        }
        
        @media (min-width: 640px) {
            body { align-items: center; padding: 20px; }
            #game-container {
                min-height: 90vh;
                border-radius: 1.5rem;
                margin: 20px 0;
            }
        }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background-color: #262626;
            padding: 24px; border-radius: 16px; width: 100%; max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            max-height: 90vh; overflow-y: auto;
        }

        .game-button {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(145deg, #fcd34d, var(--accent-yellow));
            color: #1f2937;
            font-weight: 800;
            box-shadow: 0 4px 0 #d97706, var(--shadow-gold);
            min-height: 48px; 
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3);
        }
        .game-button:hover, .game-button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d97706, 0 0 40px rgba(251, 191, 36, 1);
        }
        .game-button:active {
            box-shadow: 0 2px 0 #d97706;
            transform: translateY(2px);
        }
        .game-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: 0 4px 0 #4b5563;
            background: #4b5563;
            color: #a1a1a1;
            transform: none;
            text-shadow: none;
        }

        /* --- RAINBOW STYLES --- */
        @keyframes rainbow-text {
            0% { color: #ff0000; } 14% { color: #ff8000; } 28% { color: #ffff00; } 
            42% { color: #00ff00; } 56% { color: #0000ff; } 70% { color: #4b0082; } 
            84% { color: #9400d3; } 100% { color: #ff0000; }
        }
        .rainbow-text {
            animation: rainbow-text 3s linear infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7); 
        }

        @keyframes rainbow-border {
            0% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; } 
            14% { border-color: #ff8000; box-shadow: 0 0 15px #ff8000; }
            28% { border-color: #ffff00; box-shadow: 0 0 15px #ffff00; } 
            42% { border-color: #00ff00; box-shadow: 0 0 15px #00ff00; }
            56% { border-color: #0000ff; box-shadow: 0 0 15px #0000ff; }
            70% { border-color: #4b0082; box-shadow: 0 0 15px #4b0082; }
            84% { border-color: #9400d3; box-shadow: 0 0 15px #9400d3; }
            100% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; }
        }
        .rainbow-border {
            border: 3px solid;
            animation: rainbow-border 4s linear infinite;
        }
        
        .market-item {
            background-color: #262626;
            transition: all 0.2s;
            border-left: 5px solid #f59e0b;
        }
        .market-item.purchased {
            border-left: 5px solid #10b981; 
            background-color: #1f2937;
            opacity: 0.7;
        }
        .market-item:not(.purchased):hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        /* Yeni Reset Butonu Stili */
        .reset-button-pulse {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }
        
    </style>
</head>
<body>

    <div id="game-container" class="shadow-2xl">
        
        <div id="loading-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-50">
            <div class="text-4xl font-black text-yellow-500 animate-pulse">BatuTycoon</div>
            <p class="mt-4 text-gray-400">Veriler YÃ¼kleniyor...</p>
        </div>

        <div id="username-screen" class="modal-overlay z-40">
             <div class="modal-content text-center">
                <h2 class="text-4xl font-black text-yellow-500 mb-6">BatuTycoon GiriÅŸ</h2>
                <p class="text-gray-300 mb-4 text-center">LÃ¼tfen kalÄ±cÄ± bir kullanÄ±cÄ± adÄ± belirleyin.</p>
                <input type="text" id="username-input" placeholder="Oyuncu AdÄ±nÄ±z..." class="w-full p-4 mb-6 rounded-xl bg-gray-700 border border-gray-600 text-white text-lg focus:outline-none focus:ring-4 focus:ring-yellow-500 shadow-inner">
                <button id="start-game-button" class="game-button w-full p-4 rounded-xl text-xl">Oyuna BaÅŸla</button>
            </div>
        </div>

        <header id="game-header" class="p-4 flex flex-col items-center bg-gray-800/90 rounded-t-xl sticky top-0 z-30 shadow-2xl transition-all duration-500">
            <h1 id="main-title" class="text-4xl font-black text-yellow-400 mb-1 transition-colors duration-500">BatuTycoon</h1>
            <div class="text-xs text-gray-400 mb-3 flex items-center">
                <span id="rainbow-status-indicator" class="mr-2 text-xl hidden">ğŸŒˆ</span>
                <span>BatuTycoon (Test Version V1)</span>
            </div>
            <div class="w-full flex justify-between items-center text-lg font-bold">
                <div class="flex flex-col items-start">
                    <span id="player-username" class="text-sm text-gray-300 truncate w-24">KullanÄ±cÄ±: YÃ¼kleniyor</span>
                    <span class="text-xl text-green-400">Level: <span id="player-level">1</span></span>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-sm text-gray-300">KazanÃ§ / Saniye : <span id="gps-display">0</span></span>
                    <span id="money-display-wrapper" class="text-4xl font-extrabold text-yellow-500 text-shadow-lg transition-colors duration-500">
                        <span id="money-display">0</span> ğŸ’°
                    </span>
                </div>
            </div>
        </header>

        <div id="miner-area" class="h-64 flex flex-col justify-center p-4">
            <div class="text-center">
                <div class="text-6xl mb-4 transition-transform duration-300 hover:scale-110 cursor-pointer">â›ï¸</div>
                <p class="text-xl text-yellow-300 font-bold">KazanÃ§ Ã‡arpanÄ±: <span id="total-multiplier">x1.00</span></p>
                <p class="text-md text-gray-400">Derinlik: <span id="depth-level">1</span> | Madenci: <span id="miner-count-level">1</span></p>
                <!-- Gizli Reset Butonu (Sadece oyun bitince gÃ¶rÃ¼nÃ¼r) -->
                <button id="public-reset-button" class="hidden mt-4 bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-full reset-button-pulse transition-all">
                    ğŸ‘‘ OYUNU BÄ°TÄ°R VE SIFIRLA ğŸ‘‘
                </button>
            </div>
        </div>

        <div class="p-4">
            
            <div class="flex mb-4 space-x-2 border-b border-gray-700">
                <button data-tab="upgrades" class="tab-button text-lg px-4 py-2 font-bold rounded-t-lg bg-yellow-600 text-white shadow-lg flex-1">GeliÅŸtirmeler</button>
                <button data-tab="market" class="tab-button text-lg px-4 py-2 font-bold rounded-t-lg bg-gray-700 text-gray-300 flex-1">Market</button>
            </div>
            
            <div id="upgrades-tab" class="tab-content">
                <h2 class="text-2xl font-black text-yellow-300 mb-4 pb-2">Temel GeliÅŸtirmeler</h2>
                
                <div class="grid grid-cols-1 gap-4">
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">â›ï¸ Madenci HÄ±zÄ±</span>
                            <span id="speed-level-display" class="text-xs text-gray-300">Seviye: 1 (Ã‡arpan: x1.00)</span>
                        </div>
                        <button id="upgrade-speed-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="speed-cost">100</span> ğŸ’° YÃ¼kselt
                        </button>
                    </div>

                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">ğŸ‘· Madenci SayÄ±sÄ±</span>
                            <span id="count-level-display" class="text-xs text-gray-300">Seviye: 1 (Madenci: 1)</span>
                        </div>
                        <button id="upgrade-count-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="count-cost">200</span> ğŸ’° YÃ¼kselt
                        </button>
                    </div>
                    
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">V Maden DerinliÄŸi</span>
                            <span id="depth-level-display" class="text-xs text-gray-300">Seviye: 1 (Taban KazanÃ§ +%0)</span>
                        </div>
                        <button id="upgrade-depth-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="depth-cost">500</span> ğŸ’° YÃ¼kselt
                        </button>
                    </div>
                    
                    <div class="upgrade-card p-3 rounded-xl shadow-lg bg-gray-700">
                        <div class="flex flex-col mb-2">
                            <span class="text-lg font-extrabold text-yellow-400">â¬†ï¸ AsansÃ¶r Kapasitesi</span>
                            <span id="capacity-level-display" class="text-xs text-gray-300">Seviye: 1 (Kapasite: x1.00)</span>
                        </div>
                        <button id="upgrade-capacity-button" class="game-button w-full p-2 rounded-lg text-sm">
                            <span id="capacity-cost">750</span> ğŸ’° YÃ¼kselt
                        </button>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="level-up-button" class="game-button w-full p-4 rounded-xl text-xl">
                        Level YÃ¼kselt (Maliyet: <span id="level-cost">1000</span> ğŸ’°)
                    </button>
                    <p class="text-center text-xs text-gray-500 mt-2">Level 80'e ulaÅŸtÄ±ÄŸÄ±nda oyunu bitirebilirsin.</p>
                </div>
            </div>
            
            <div id="market-tab" class="tab-content hidden">
                <h2 class="text-2xl font-black text-yellow-300 mb-4 pb-2">Pazar/DÃ¼kkan (KalÄ±cÄ± Ã‡arpanlar)</h2>
                <div id="market-items-list" class="space-y-3 pb-8">
                    <p class="text-gray-400 text-center py-4">Ã–ÄŸeler yÃ¼kleniyor...</p>
                </div>
            </div>
        </div>

        <div class="sticky bottom-0 left-0 right-0 p-4 bg-gray-800/90 border-t border-gray-700 shadow-inner z-20">
            <p id="message-box" class="text-center text-sm text-red-400 mb-2 h-5"></p>
            <div class="flex justify-between items-center text-xs text-gray-500">
                <button id="hard-reset-btn" class="hover:text-red-500 transition">âš ï¸ SÄ±fÄ±rla</button>
                <span>YapÄ±mcÄ±: Batu</span>
                <button id="admin-button" class="hover:text-yellow-500 transition">Admin Paneli</button>
            </div>
        </div>
    </div>

    <!-- Offline KazanÃ§ ModalÄ± -->
    <div id="offline-modal" class="modal-overlay">
        <div class="modal-content text-center">
            <h3 class="text-3xl font-black text-yellow-500 mb-4">HoÅŸ Geldiniz!</h3>
            <p class="text-lg text-gray-300 mb-4">Ã‡evrimdÄ±ÅŸÄ± kazancÄ±nÄ±z:</p>
            <p class="text-4xl font-extrabold text-green-400 mb-6">
                <span id="offline-money-display">0</span> ğŸ’°
            </p>
            <button id="close-offline-modal" class="game-button px-8 py-3 rounded-lg text-xl">Harika!</button>
        </div>
    </div>

    <!-- Zafer / Reset ModalÄ± -->
    <div id="victory-modal" class="modal-overlay">
        <div class="modal-content text-center border-4 border-yellow-500">
            <div class="text-6xl mb-4">ğŸ‘‘</div>
            <h3 class="text-3xl font-black text-yellow-500 mb-4">TEBRÄ°KLER!</h3>
            <p class="text-lg text-gray-300 mb-4">Maden Ä°mparatorluÄŸunun zirvesine ulaÅŸtÄ±n! (Level 500)</p>
            <p class="text-md text-gray-400 mb-6">Oyunu baÅŸarÄ±yla tamamladÄ±n. Åimdi her ÅŸeyi sÄ±fÄ±rlayÄ±p yeni bir maceraya atÄ±lma zamanÄ±!</p>
            
            <div class="flex flex-col gap-3">
                <button id="victory-reset-button" class="game-button px-8 py-3 rounded-lg text-xl bg-red-600 hover:bg-red-500 border-2 border-yellow-400">
                    ğŸ† Efsanevi SÄ±fÄ±rlama Yap
                </button>
                <button id="close-victory-modal" class="text-gray-400 underline hover:text-white mt-2">
                    Oyuna DÃ¶n (Ä°zlemek Ä°Ã§in)
                </button>
            </div>
        </div>
    </div>

    <!-- Admin ModalÄ± -->
    <div id="admin-modal" class="modal-overlay">
        <div class="modal-content" id="admin-modal-content">
            <h3 class="text-2xl font-bold text-red-400 mb-4 border-b-2 border-red-700 pb-2">âš”ï¸Admin Paneli</h3>
            
            <div id="admin-login" class="mb-4">
                <p class="text-gray-300 mb-2">LÃ¼tfen ÅŸifreyi girin:</p>
                <input type="password" id="admin-password-input" placeholder="Åifre" class="w-full p-3 mb-4 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                <button id="admin-login-button" class="game-button w-full p-3 bg-red-600 hover:bg-red-500 text-white shadow-none">GiriÅŸ Yap</button>
            </div>
            
            <div id="admin-controls" class="hidden">
                <p class="text-sm text-gray-400 mb-4">Oturum Tipi: <span class="text-yellow-400 font-bold">YapÄ±mcÄ± :) Batu</span></p>
                
                <div class="mb-6 border-t border-gray-600 pt-4">
                    <h4 class="text-xl font-bold text-yellow-400 mb-2">Kod Gir </h4>
                    <p class="text-xs text-gray-500 mb-2">Kodlar : BATUEFFECT~BATUHÄ°ZLÄ°~BATUMAXLA~BATUZENGÄ°N~BATUTYCOONTEST</p>
                    <input type="text" id="cheat-code-input" placeholder="Kodu Gir..." class="w-full p-3 mb-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 uppercase">
                    <button id="apply-cheat-button" class="game-button w-full p-3 bg-yellow-600 hover:bg-yellow-500 text-white shadow-none">Kodu Uygula</button>
                </div>
                
                <button id="admin-cheat-money" class="game-button w-full p-3 mb-3 bg-green-600 hover:bg-green-500 text-white shadow-none">10 Milyon ğŸ’° Ekle</button>
                <button id="admin-cheat-max-all" class="game-button w-full p-3 mb-3 bg-purple-600 hover:bg-purple-500 text-white shadow-none">Max Level & TÃ¼m GeliÅŸtirmeler</button>
                <button id="admin-cheat-unlock-market" class="game-button w-full p-3 mb-3 bg-blue-600 hover:bg-blue-500 text-white shadow-none">TÃ¼m Pazar Ã–ÄŸelerini Al</button>
                <button id="admin-reset-data" class="game-button w-full p-3 mb-4 bg-gray-600 hover:bg-gray-500 text-white shadow-none">Verileri TAMAMEN SÄ±fÄ±rla</button>
                <button id="admin-close" class="game-button w-full p-3 bg-red-400 hover:bg-red-300 text-white shadow-none">Paneli Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // --- Game Variables ---
        let gameLoopInterval = null;

        const ADMIN_PASSWORD = "BatuTycoonTest";
        const LOCAL_STORAGE_KEY = 'batu_tycoon_v2_data'; // Anahtar deÄŸiÅŸti, temiz baÅŸlangÄ±Ã§ iÃ§in

        // Game State (Default Values)
        let game = {
            username: '',
            money: 0,
            level: 1,
            speedLevel: 1,
            minerCountLevel: 1,
            shaftDepthLevel: 1,
            elevatorCapacityLevel: 1,
            lastSaveTime: Date.now(),
            isRainbowMode: false,
            purchases: {},
            hasFinishedGame: false // Yeni deÄŸiÅŸken
        };

        // --- Market Items (GENÄ°ÅLETÄ°LMÄ°Å LÄ°STE - 57 Ã–ÄE) ---
        const MARKET_ITEMS = [
            // --- YatÄ±rÄ±m ---
            { key: 'M01', name: 'Micro YatÄ±rÄ±mcÄ±', cost: 10000, multiplier: 1.05, category: 'YatÄ±rÄ±m', icon: 'ğŸ“ˆ' },
            { key: 'M02', name: 'Kripto Fonu', cost: 50000, multiplier: 1.10, category: 'YatÄ±rÄ±m', icon: 'â‚¿' },
            { key: 'M03', name: 'Gayrimenkul Ä°mparatoru', cost: 250000, multiplier: 1.15, category: 'YatÄ±rÄ±m', icon: 'ğŸ ' },
            { key: 'M04', name: 'Borsa SihirbazÄ±', cost: 1000000, multiplier: 1.20, category: 'YatÄ±rÄ±m', icon: 'ğŸ“Š' },
            { key: 'M05', name: 'Gelecek SÃ¶zleÅŸmesi', cost: 5000000, multiplier: 1.25, category: 'YatÄ±rÄ±m', icon: 'ğŸ“œ' },
            
            // --- Teknoloji ---
            { key: 'T06', name: 'GeliÅŸmiÅŸ Sondaj Ucu', cost: 15000, multiplier: 1.07, category: 'Teknoloji', icon: 'ğŸ”©' },
            { key: 'T07', name: 'Titanyum Kovalar', cost: 75000, multiplier: 1.12, category: 'Teknoloji', icon: 'ğŸª£' },
            { key: 'T08', name: 'Yapay Zeka Navigasyon', cost: 300000, multiplier: 1.18, category: 'Teknoloji', icon: 'ğŸ¤–' },
            { key: 'T09', name: 'Anti-YerÃ§ekimi TaÅŸÄ±yÄ±cÄ±', cost: 1200000, multiplier: 1.22, category: 'Teknoloji', icon: 'ğŸ›¸' },
            { key: 'T10', name: 'NÃ¼kleer Enerji Santrali', cost: 6000000, multiplier: 1.30, category: 'Teknoloji', icon: 'âš›ï¸' },
            
            // --- Personel ---
            { key: 'P11', name: 'Uzman Jeolog', cost: 20000, multiplier: 1.06, category: 'Personel', icon: 'ğŸ”¬' },
            { key: 'P12', name: 'GÃ¼venlik TakÄ±mÄ±', cost: 90000, multiplier: 1.11, category: 'Personel', icon: 'ğŸ›¡ï¸' },
            { key: 'P13', name: 'Liderlik EÄŸitimi', cost: 400000, multiplier: 1.16, category: 'Personel', icon: 'ğŸ“' },
            { key: 'P14', name: 'SÃ¼pervizÃ¶r Robot', cost: 1500000, multiplier: 1.21, category: 'Personel', icon: 'âš™ï¸' },
            { key: 'P15', name: 'YÃ¶netim Merkezi', cost: 7000000, multiplier: 1.27, category: 'Personel', icon: 'ğŸ›ï¸' },
            
            // --- AltyapÄ± ---
            { key: 'L16', name: 'GeniÅŸletilmiÅŸ Depo', cost: 30000, multiplier: 1.08, category: 'AltyapÄ±', icon: 'ğŸ“¦' },
            { key: 'L17', name: 'HÄ±zlÄ± Tren Lojistik', cost: 110000, multiplier: 1.13, category: 'AltyapÄ±', icon: 'ğŸš†' },
            { key: 'L18', name: 'Otomasyon HattÄ±', cost: 500000, multiplier: 1.19, category: 'AltyapÄ±', icon: 'â›“ï¸' },
            { key: 'L19', name: 'Uydu Ä°zleme', cost: 2000000, multiplier: 1.23, category: 'AltyapÄ±', icon: 'ğŸ›°ï¸' },
            { key: 'L20', name: 'Uzay LimanÄ±', cost: 10000000, multiplier: 1.35, category: 'AltyapÄ±', icon: 'ğŸš€' },

            // --- Prestij ---
            { key: 'C21', name: 'AltÄ±n Kaplama Kazma', cost: 40000, multiplier: 1.04, category: 'Prestij', icon: 'ğŸ¥‡' },
            { key: 'C22', name: 'Ã–zel Logolu Kask', cost: 150000, multiplier: 1.05, category: 'Prestij', icon: 'â­' },
            { key: 'C23', name: 'Madenci Heykeli', cost: 600000, multiplier: 1.06, category: 'Prestij', icon: 'ğŸ—¿' },
            { key: 'C24', name: 'BÃ¶lgesel Sponsorluk', cost: 2500000, multiplier: 1.07, category: 'Prestij', icon: 'ğŸ“°' },
            { key: 'C25', name: 'DÃ¼nya Merkezi', cost: 12000000, multiplier: 1.08, category: 'Prestij', icon: 'ğŸŒ' },
            
            // --- Kozmik (YENÄ° EK) ---
            { key: 'K35', name: 'Asteroid MadenciliÄŸi', cost: 25000000, multiplier: 1.40, category: 'Kozmik', icon: 'â˜„ï¸' },
            { key: 'K36', name: 'Ay ÃœssÃ¼ Alpha', cost: 50000000, multiplier: 1.50, category: 'Kozmik', icon: 'ğŸŒ‘' },
            { key: 'K37', name: 'Mars Kolonisi', cost: 100000000, multiplier: 1.60, category: 'Kozmik', icon: 'ğŸª' },
            { key: 'K38', name: 'JÃ¼piter Gaz ToplayÄ±cÄ±', cost: 250000000, multiplier: 1.75, category: 'Kozmik', icon: 'ğŸŒ«ï¸' },
            { key: 'K39', name: 'GÃ¼neÅŸ Paneli AÄŸÄ±', cost: 500000000, multiplier: 1.90, category: 'Kozmik', icon: 'â˜€ï¸' },

            // --- Kuantum (YENÄ° EK) ---
            { key: 'Q40', name: 'Kuantum Kazma', cost: 800000000, multiplier: 2.10, category: 'Kuantum', icon: 'âš›ï¸' },
            { key: 'Q41', name: 'DolanÄ±klÄ±k Ä°letiÅŸimi', cost: 1500000000, multiplier: 2.30, category: 'Kuantum', icon: 'ğŸ”—' },
            { key: 'Q42', name: 'SÃ¼perpozisyon Deposu', cost: 3000000000, multiplier: 2.50, category: 'Kuantum', icon: 'ğŸ“¦' },
            { key: 'Q43', name: 'SchrÃ¶dinger\'in Kedisi', cost: 5000000000, multiplier: 2.75, category: 'Kuantum', icon: 'ğŸˆ' },

            // --- BoyutlararasÄ± (YENÄ° EK) ---
            { key: 'D44', name: '4. Boyut Cebi', cost: 10000000000, multiplier: 3.00, category: 'BoyutlararasÄ±', icon: 'ğŸŒ€' },
            { key: 'D45', name: 'Solucan DeliÄŸi AsansÃ¶rÃ¼', cost: 25000000000, multiplier: 3.50, category: 'BoyutlararasÄ±', icon: 'ğŸ•³ï¸' },
            { key: 'D46', name: 'Zaman Yolcusu Ä°ÅŸÃ§iler', cost: 50000000000, multiplier: 4.00, category: 'BoyutlararasÄ±', icon: 'â³' },
            { key: 'D47', name: 'Paralel Evren Ä°thalatÄ±', cost: 100000000000, multiplier: 4.50, category: 'BoyutlararasÄ±', icon: 'ğŸšª' },

            // --- Mitolojik (YENÄ° EK) ---
            { key: 'M48', name: 'Midas\'Ä±n DokunuÅŸu', cost: 200000000000, multiplier: 5.00, category: 'Mitolojik', icon: 'ğŸ–ï¸' },
            { key: 'M49', name: 'Hephaestus\'un Ã–rsÃ¼', cost: 400000000000, multiplier: 5.50, category: 'Mitolojik', icon: 'ğŸ”¨' },
            { key: 'M50', name: 'Atlas\'Ä±n GÃ¼cÃ¼', cost: 750000000000, multiplier: 6.00, category: 'Mitolojik', icon: 'ğŸ‹ï¸' },
            
            // --- FÃ¼tÃ¼ristik (YENÄ° EK) ---
            { key: 'F51', name: 'Sibernetik Ä°mplantlar', cost: 1000000000000, multiplier: 7.00, category: 'FÃ¼tÃ¼ristik', icon: 'ğŸ¦¾' },
            { key: 'F52', name: 'Dyson KÃ¼resi', cost: 2500000000000, multiplier: 8.00, category: 'FÃ¼tÃ¼ristik', icon: 'ğŸŒ' },
            { key: 'F53', name: 'Galaktik Ticaret BirliÄŸi', cost: 5000000000000, multiplier: 9.00, category: 'FÃ¼tÃ¼ristik', icon: 'ğŸ¤' },

            // --- AbsÃ¼rt (YENÄ° EK) ---
            { key: 'A54', name: 'Sonsuzluk Eldiveni (Replika)', cost: 10000000000000, multiplier: 10.00, category: 'AbsÃ¼rt', icon: 'ğŸ§¤' },
            { key: 'A55', name: 'YazÄ±lÄ±mcÄ± GÃ¶zyaÅŸlarÄ±', cost: 25000000000000, multiplier: 12.00, category: 'AbsÃ¼rt', icon: 'ğŸ’§' },
            { key: 'A56', name: 'SimÃ¼lasyon HatasÄ±', cost: 50000000000000, multiplier: 15.00, category: 'AbsÃ¼rt', icon: 'ğŸ‘¾' },
            { key: 'A57', name: 'BÃ¼yÃ¼k Patlama 2.0', cost: 100000000000000, multiplier: 20.00, category: 'AbsÃ¼rt', icon: 'ğŸ’¥' },

            // --- Bonus & Ã–zel (Mevcutlar) ---
            { key: 'B26', name: 'Mega Verimlilik ÅemasÄ±', cost: 15000000, multiplier: 1.50, category: 'Bonus', icon: 'âœ¨' },
            { key: 'B27', name: 'Kara Delik SimÃ¼latÃ¶rÃ¼', cost: 30000000, multiplier: 1.75, category: 'Bonus', icon: 'âš«' },
            { key: 'E28', name: 'Batu\'nun Åans TÄ±lsÄ±mÄ±', cost: 50000000, multiplier: 2.00, category: 'Ã–zel', icon: 'ğŸ€' },
            { key: 'E29', name: 'Sonsuz Enerji Pili', cost: 100000000, multiplier: 2.50, category: 'Ã–zel', icon: 'ğŸ”‹' },
            { key: 'E30', name: 'Zaman BÃ¼kÃ¼cÃ¼', cost: 200000000, multiplier: 3.00, category: 'Ã–zel', icon: 'â³' },
            { key: 'E31', name: 'Anti-Kriz SigortasÄ±', cost: 300000000, multiplier: 3.50, category: 'Ã–zel', icon: 'ğŸ›¡ï¸' },
            { key: 'E32', name: 'KainatÄ±n AnahtarÄ±', cost: 500000000, multiplier: 4.00, category: 'Ã–zel', icon: 'ğŸ”‘' },
            { key: 'E33', name: 'GÃ¶kkuÅŸaÄŸÄ± PatlamasÄ±', cost: 750000000, multiplier: 5.00, category: 'Ã–zel', icon: 'ğŸŒˆ' },
            { key: 'E34', name: 'Evrensel Kaynak', cost: 1000000000, multiplier: 10.00, category: 'Ã–zel', icon: 'ğŸŒŒ' },
        ];


        // Constants and Cost Calculation Functions
        const BASE_RATE = 100; 
        const MAX_LEVEL = 500; 
        const MAX_UPGRADE_LEVEL = 500; 
        const RAINBOW_CODES = {
            "BATUEFFECT": { effect: "toggle_rainbow", message: "GÃ¶kkuÅŸaÄŸÄ± Efekti AÃ§Ä±ldÄ±/KapandÄ±!", fn: () => { game.isRainbowMode = !game.isRainbowMode; updateRainbowEffect(); } },
            "BATUHÄ°ZLÄ°": { effect: "speed_max", message: `Madenci HÄ±zÄ± MAX (${MAX_UPGRADE_LEVEL}) yapÄ±ldÄ±!`, fn: () => { game.speedLevel = MAX_UPGRADE_LEVEL; } },
            "BATUZENGÄ°N": { effect: "add_1B", message: "1 Milyar (1G) Para Eklendi!", fn: () => { game.money += 1000000000; } },
            "BATUTYCOONTEST": { effect: "max_all", message: `TÃ¼m Temel GeliÅŸtirmeler MAX yapÄ±ldÄ±!`, fn: () => { game.speedLevel = MAX_UPGRADE_LEVEL; game.minerCountLevel = MAX_UPGRADE_LEVEL; game.shaftDepthLevel = MAX_UPGRADE_LEVEL; game.elevatorCapacityLevel = MAX_UPGRADE_LEVEL; } },
            "BATUMAXLA": { effect: "unlock_market", message: "TÃ¼m Pazar Ã–ÄŸeleri Ãœcretsiz AlÄ±ndÄ±!", fn: () => { MARKET_ITEMS.forEach(item => { game.purchases[item.key] = true; }); } }
        };

        const getSpeedCost = (level) => Math.floor(100 * (1.5 ** (level - 1)));
        const getCountCost = (level) => Math.floor(200 * (1.6 ** (level - 1)));
        const getDepthCost = (level) => Math.floor(500 * (1.7 ** (level - 1)));
        const getCapacityCost = (level) => Math.floor(750 * (1.8 ** (level - 1)));
        const getLevelCost = (level) => Math.floor(1000 * (1.9 ** (level - 1)));

        // --- LocalStorage Persistence Functions ---

        function loadGameData() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            // YÃ¼kleme ekranÄ±nÄ± gizleme komutu DOMContentLoaded bloÄŸunun sonuna taÅŸÄ±ndÄ±.

            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    
                    game.username = parsedData.username || '';
                    // Yeni verileri yÃ¼kle, ancak maksimum seviyeleri aÅŸmadÄ±ÄŸÄ±ndan emin ol
                    game.money = parsedData.money || 0;
                    game.level = Math.min(parsedData.level || 1, MAX_LEVEL); 
                    game.speedLevel = Math.min(parsedData.speedLevel || 1, MAX_UPGRADE_LEVEL);
                    game.minerCountLevel = Math.min(parsedData.minerCountLevel || 1, MAX_UPGRADE_LEVEL);
                    game.shaftDepthLevel = Math.min(parsedData.shaftDepthLevel || 1, MAX_UPGRADE_LEVEL);
                    game.elevatorCapacityLevel = Math.min(parsedData.elevatorCapacityLevel || 1, MAX_UPGRADE_LEVEL);
                    game.isRainbowMode = parsedData.isRainbowMode || false; 
                    game.purchases = parsedData.purchases || {}; 
                    game.hasFinishedGame = parsedData.hasFinishedGame || false;

                    const savedTime = parsedData.lastSaveTime || Date.now();
                    calculateOfflineEarning(savedTime);
                    
                    return true;
                } catch (e) {
                    console.error("localStorage verisi Ã§Ã¶zÃ¼mlenirken hata:", e);
                    return false;
                }
            }
            return false;
        }

        function saveGameData() {
            game.lastSaveTime = Date.now();
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(game));
            } catch (error) {
                console.error("KayÄ±t hatasÄ±:", error);
            }
        }
        
        // --- Game Flow ---

        function checkUsernameAndStart() {
            if (!game.username) {
                document.getElementById('username-screen').style.display = 'flex'; 
            } else {
                startGame();
            }
        }

        function startGame() {
            document.getElementById('username-screen').style.display = 'none'; 
            
            setupTabs();
            renderMarketItems();
            updateRainbowEffect();
            updateUI();
            
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 1000); 

            setInterval(saveGameData, 15000); 
            
            // EÄŸer oyun bitmiÅŸse, yeniden aÃ§Ä±ldÄ±ÄŸÄ±nda Zafer Modal'Ä±nÄ± gÃ¶ster
            if (game.hasFinishedGame && game.level >= MAX_LEVEL) {
                 showVictoryModal();
            }
        }
        
        // --- Game Mechanics ---
        
        function performUpgrade(costFunc, levelKey, name, maxLevel) {
            const currentLevel = game[levelKey];
            if (currentLevel >= maxLevel) {
                showMessage(`Maksimum ${name} seviyesine ulaÅŸÄ±ldÄ±.`, 'yellow');
                return;
            }
            const cost = costFunc(currentLevel);

            if (game.money >= cost) {
                game.money -= cost;
                game[levelKey]++;
                showMessage(`${name} yÃ¼kseltildi! Seviye: ${game[levelKey]}`, 'green');
                
                // Level Up Ã¶zel kontrolÃ¼
                if(levelKey === 'level' && game.level >= MAX_LEVEL) {
                     game.hasFinishedGame = true;
                     showVictoryModal();
                }

            } else {
                showMessage(`Yetersiz Para! ${formatNumber(cost)} ğŸ’° gerekli.`, 'red');
            }
            updateUI();
            saveGameData(); 
        }

        function calculateGPS() {
            const depthMultiplier = 1 + (0.20 * (game.shaftDepthLevel - 1));
            const baseEarning = BASE_RATE * depthMultiplier;

            const speedMultiplier = 1 + (0.1 * (game.speedLevel - 1));
            const minerCount = game.minerCountLevel;
            const capacityMultiplier = 1 + (0.15 * (game.elevatorCapacityLevel - 1));

            let marketMultiplier = 1.0;
            MARKET_ITEMS.forEach(item => {
                if (game.purchases[item.key]) {
                    marketMultiplier *= item.multiplier;
                }
            });

            // Toplam Ã§arpanÄ± game objesine kaydet (UI iÃ§in)
            game.totalMultiplier = marketMultiplier; 
            
            const gps = baseEarning * speedMultiplier * minerCount * capacityMultiplier * marketMultiplier;
            return Math.floor(gps);
        }

        function gameLoop() {
            const gps = calculateGPS();
            game.money += gps;
            updateUI();
        }

        function calculateOfflineEarning(savedTime) {
            const currentTime = Date.now();
            // Maksimum 72 saat (259200 saniye) offline kazanÃ§ hesapla
            const maxOfflineTime = 259200; 
            const timeElapsedSeconds = Math.min(Math.floor((currentTime - savedTime) / 1000), maxOfflineTime);

            if (timeElapsedSeconds > 5) { 
                const offlineGPS = calculateGPS(); 
                const offlineEarnings = offlineGPS * timeElapsedSeconds;
                
                game.money += offlineEarnings;

                if (offlineEarnings > 0) {
                    document.getElementById('offline-money-display').textContent = formatNumber(offlineEarnings);
                    document.getElementById('offline-modal').style.display = 'flex';
                }
            }
        }
        
        function buyMarketItem(itemKey) {
            if (game.purchases[itemKey]) {
                showMessage('Bu Ã¶ÄŸeye zaten sahipsiniz!', 'yellow');
                return;
            }

            const item = MARKET_ITEMS.find(i => i.key === itemKey);
            if (!item) return;

            if (game.money >= item.cost) {
                game.money -= item.cost;
                game.purchases[itemKey] = true;
                showMessage(`${item.name} satÄ±n alÄ±ndÄ±! KazanÃ§ Ã§arpanÄ± arttÄ±.`, 'green');
                updateUI();
                renderMarketItems(); 
                saveGameData(); 
            } else {
                showMessage(`Yetersiz Para! ${formatNumber(item.cost)} ğŸ’° gerekli.`, 'red');
            }
        }


        // --- UI and Animation Operations ---

        function formatNumber(num) {
            const suffixes = ['', 'K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y']; // Bin, Milyon, Milyar, Trilyon, Katrilyon...
            const tier = Math.floor(Math.log10(Math.abs(num)) / 3);

            if (tier === 0 || isNaN(num) || num === 0) {
                return Math.floor(num).toLocaleString('tr-TR');
            }

            const suffix = suffixes[tier];
            const scale = Math.pow(10, tier * 3);
            const scaled = num / scale;

            return scaled.toFixed(2) + suffix;
        }


        function updateUI() {
            const gps = calculateGPS();

            document.getElementById('money-display').textContent = formatNumber(game.money);
            document.getElementById('gps-display').textContent = formatNumber(gps);
            document.getElementById('player-level').textContent = game.level;
            document.getElementById('player-username').textContent = `KullanÄ±cÄ±: ${game.username || 'Anonim'}`;
            document.getElementById('depth-level').textContent = game.shaftDepthLevel;
            document.getElementById('miner-count-level').textContent = game.minerCountLevel;
            
            // Toplam Ã§arpanÄ± doÄŸrudan game objesinden al
            document.getElementById('total-multiplier').textContent = `x${game.totalMultiplier.toFixed(2)}`;
            
            updateUpgradeButton('speed', getSpeedCost, game.speedLevel, MAX_UPGRADE_LEVEL, 'speed-level-display', 
                (level) => `Seviye: ${level} (Ã‡arpan: x${(1 + 0.1 * (level - 1)).toFixed(2)})`);
            updateUpgradeButton('count', getCountCost, game.minerCountLevel, MAX_UPGRADE_LEVEL, 'count-level-display', 
                (level) => `Seviye: ${level} (Madenci: ${level})`);
            updateUpgradeButton('depth', getDepthCost, game.shaftDepthLevel, MAX_UPGRADE_LEVEL, 'depth-level-display',
                (level) => `Seviye: ${level} (Taban KazanÃ§ +%${((level - 1) * 20)})`);
            updateUpgradeButton('capacity', getCapacityCost, game.elevatorCapacityLevel, MAX_UPGRADE_LEVEL, 'capacity-level-display',
                (level) => `Seviye: ${level} (Kapasite: x${(1 + 0.15 * (level - 1)).toFixed(2)})`);
            
            const levelCost = getLevelCost(game.level);
            const levelBtn = document.getElementById('level-up-button');
            document.getElementById('level-cost').textContent = formatNumber(levelCost);
            
            const publicResetBtn = document.getElementById('public-reset-button');

            if (game.level >= MAX_LEVEL) {
                levelBtn.disabled = true;
                levelBtn.innerHTML = `ğŸ‘‘ OYUN BÄ°TTÄ° (MAX LEVEL)`;
                levelBtn.classList.remove('bg-yellow-600');
                levelBtn.classList.add('bg-purple-600');
                
                // Oyunu bitirme/sÄ±fÄ±rlama butonunu gÃ¶ster
                publicResetBtn.classList.remove('hidden');
                
            } else {
                levelBtn.disabled = game.money < levelCost;
                levelBtn.innerHTML = `Level YÃ¼kselt (Maliyet: <span id="level-cost">${formatNumber(levelCost)}</span> ğŸ’°)`;
                levelBtn.classList.add('bg-yellow-600');
                levelBtn.classList.remove('bg-purple-600');
                publicResetBtn.classList.add('hidden');
            }
            
            updateMarketButtonStates();
        }

        function updateUpgradeButton(name, costFunc, currentLevel, maxLevel, displayId, displayFormatter) {
            const cost = costFunc(currentLevel);
            const btn = document.getElementById(`upgrade-${name}-button`);
            const costSpan = document.getElementById(`${name}-cost`);
            const displaySpan = document.getElementById(displayId);

            displaySpan.textContent = displayFormatter(currentLevel);
            
            if (currentLevel >= maxLevel) {
                btn.disabled = true;
                costSpan.textContent = 'MAX';
                btn.innerHTML = `MAX (${maxLevel})`;
            } else {
                costSpan.textContent = formatNumber(cost);
                btn.disabled = game.money < cost;
            }
        }
        
        function renderMarketItems() {
            const list = document.getElementById('market-items-list');
            list.innerHTML = '';
            
            let currentCategory = '';
            
            MARKET_ITEMS.forEach(item => {
                if (item.category !== currentCategory) {
                    currentCategory = item.category;
                    const header = document.createElement('h3');
                    header.className = 'text-xl font-bold text-yellow-500 mt-6 mb-2 border-b-2 border-yellow-700 pb-1 pl-2';
                    header.textContent = `${item.icon} ${item.category} GÃ¼Ã§lendirmeleri`;
                    list.appendChild(header);
                }

                const isPurchased = game.purchases[item.key];
                const itemDiv = document.createElement('div');
                itemDiv.id = `market-item-${item.key}`;
                itemDiv.className = `market-item p-3 rounded-xl shadow-md flex justify-between items-center mb-2 ${isPurchased ? 'purchased' : 'bg-gray-800'}`;
                
                itemDiv.innerHTML = `
                    <div>
                        <p class="text-sm md:text-lg font-bold ${isPurchased ? 'text-green-400' : 'text-yellow-300'}">${item.icon} ${item.name}</p>
                        <p class="text-xs text-gray-400">Ã‡arpan: x${item.multiplier.toFixed(2)}</p>
                    </div>
                    <button 
                        data-key="${item.key}"
                        class="market-buy-button game-button p-2 rounded-lg text-xs md:text-sm ml-2 w-28 transition-all duration-150 ${isPurchased ? 'bg-green-600 hover:bg-green-600' : ''}"
                        ${isPurchased ? 'disabled' : ''}
                    >
                        ${isPurchased ? 'ALINDI' : `${formatNumber(item.cost)} ğŸ’°`}
                    </button>
                `;
                
                list.appendChild(itemDiv);
            });
            
            list.querySelectorAll('.market-buy-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const key = e.currentTarget.getAttribute('data-key');
                    buyMarketItem(key);
                });
            });
            
            updateMarketButtonStates(); 
        }
        
        function updateMarketButtonStates() {
            document.querySelectorAll('.market-buy-button').forEach(button => {
                const key = button.getAttribute('data-key');
                const item = MARKET_ITEMS.find(i => i.key === key);
                
                if (game.purchases[key] || !item) {
                    button.disabled = true;
                    button.textContent = 'ALINDI';
                    button.parentElement.classList.add('purchased');
                } else {
                    const canBuy = game.money >= item.cost;
                    button.disabled = !canBuy;
                    button.textContent = `${formatNumber(item.cost)} ğŸ’°`;
                    button.parentElement.classList.remove('purchased');
                }
            });
        }


        function updateRainbowEffect() {
            const container = document.getElementById('game-container');
            const moneyDisplay = document.getElementById('money-display-wrapper');
            const mainTitle = document.getElementById('main-title');
            const indicator = document.getElementById('rainbow-status-indicator');
            const header = document.getElementById('game-header');
            
            if (game.isRainbowMode) {
                moneyDisplay.classList.add('rainbow-text');
                mainTitle.classList.add('rainbow-text');
                indicator.classList.remove('hidden');
                header.classList.add('rainbow-border');
                container.style.backgroundColor = 'var(--rainbow-bg)'; 
            } else {
                moneyDisplay.classList.remove('rainbow-text');
                mainTitle.classList.remove('rainbow-text');
                indicator.classList.add('hidden');
                header.classList.remove('rainbow-border');
                container.style.backgroundColor = 'var(--secondary-dark)';
            }
        }

        function showMessage(msg, color) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = msg;
            msgBox.className = `text-center text-sm mb-2 text-${color}-400 font-semibold animate-pulse`; 
            setTimeout(() => {
                msgBox.textContent = '';
                msgBox.className = `text-center text-sm mb-2 text-red-400`;
            }, 2500);
        }
        
        // --- Admin & Victory Logic ---
        function showVictoryModal() {
             document.getElementById('victory-modal').style.display = 'flex';
        }

        function showAdminModal() {
            document.getElementById('admin-modal').style.display = 'flex';
            document.getElementById('admin-password-input').value = '';
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-controls').classList.add('hidden');
            document.getElementById('cheat-code-input').value = ''; 
        }

        function adminLogin() {
            const password = document.getElementById('admin-password-input').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-controls').classList.remove('hidden');
                showMessage("Admin GiriÅŸi BaÅŸarÄ±lÄ±!", 'green');
            } else {
                showMessage("Admin Åifresi YanlÄ±ÅŸ!", 'red');
                document.getElementById('admin-password-input').value = '';
            }
        }

        function adminCheatMoney() {
            game.money += 10000000; 
            updateUI();
            saveGameData();
            showMessage("10M Para Eklendi!", 'green');
        }

        function adminCheatMaxAll() {
            game.level = MAX_LEVEL;
            game.speedLevel = MAX_UPGRADE_LEVEL;
            game.minerCountLevel = MAX_UPGRADE_LEVEL;
            game.shaftDepthLevel = MAX_UPGRADE_LEVEL;
            game.elevatorCapacityLevel = MAX_UPGRADE_LEVEL;
            game.hasFinishedGame = true;
            updateUI();
            saveGameData();
            showMessage(`Temel GeliÅŸtirmeler MAX'landÄ±!`, 'green');
            showVictoryModal(); // Admin ile maxlayÄ±nca da victory Ã§Ä±ksÄ±n
        }
        
        function adminCheatUnlockMarket() {
            MARKET_ITEMS.forEach(item => {
                game.purchases[item.key] = true;
            });
            updateUI();
            renderMarketItems();
            saveGameData();
            showMessage("TÃ¼m Pazar Ã–ÄŸeleri AlÄ±ndÄ±!", 'green');
        }

        function publicResetData() {
             const confirmation = prompt('TÃœM Ä°LERLEMENÄ° SIFIRLAMAK ÃœZERESÄ°N!\nBunu yapmak istiyor musun?\nOnaylamak iÃ§in "EVET" yaz.');
             if (confirmation !== 'EVET') {
                 return;
             }
             
             resetGameLogic();
             document.getElementById('victory-modal').style.display = 'none';
        }

        function adminResetData() {
            const confirmation = prompt('TÃœM VERÄ°LERÄ° SIFIRLAMAK Ä°Ã‡Ä°N "SÄ±fÄ±rla" yazÄ±n. (KullanÄ±cÄ± adÄ± korunur)');
            if (confirmation !== 'SÄ±fÄ±rla') {
                showMessage('SÄ±fÄ±rlama iptal edildi.', 'yellow');
                return;
            }
            
            resetGameLogic();
            document.getElementById('admin-modal').style.display = 'none';
        }

        function resetGameLogic() {
            // KullanÄ±cÄ± adÄ±nÄ± yedekle
            const currentUsername = game.username;
            
            // Veri sÄ±fÄ±rlama
            game = {
                username: currentUsername, 
                money: 0,
                level: 1,
                speedLevel: 1,
                minerCountLevel: 1,
                shaftDepthLevel: 1,
                elevatorCapacityLevel: 1,
                lastSaveTime: Date.now(),
                isRainbowMode: false,
                purchases: {}, // Market Ã¶ÄŸeleri sÄ±fÄ±rlanÄ±r
                hasFinishedGame: false
            };
            
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(game)); // Yeni sÄ±fÄ±rlanmÄ±ÅŸ veriyi kaydet
            
            updateRainbowEffect();
            updateUI();
            renderMarketItems();
            
            // SÄ±fÄ±rlama sonrasÄ± ana ekrana dÃ¶nmÃ¼ÅŸ gibi
            document.getElementById('public-reset-button').classList.add('hidden');
            showMessage("Oyun SÄ±fÄ±rlandÄ±! Yeni maceranda baÅŸarÄ±lar.", 'green');
        }
        
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    tabButtons.forEach(btn => {
                        btn.classList.remove('bg-yellow-600', 'text-white');
                        btn.classList.add('bg-gray-700', 'text-gray-300');
                    });
                    button.classList.add('bg-yellow-600', 'text-white');
                    button.classList.remove('bg-gray-700', 'text-gray-300');

                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
                });
            });
        }


        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            loadGameData();
            checkUsernameAndStart();
            
            // Hata DÃ¼zeltme: YÃ¼kleme ekranÄ±nÄ±n, tÃ¼m baÅŸlangÄ±Ã§ mantÄ±ÄŸÄ± (veri yÃ¼kleme, kullanÄ±cÄ± kontrolÃ¼)
            // bittikten sonra gizlendiÄŸinden emin olmak iÃ§in buraya taÅŸÄ±dÄ±k.
            document.getElementById('loading-screen').classList.add('hidden');

            document.getElementById('start-game-button').addEventListener('click', () => {
                const username = document.getElementById('username-input').value.trim();
                if (username.length > 2 && username.length < 20) {
                    game.username = username;
                    saveGameData();
                    startGame();
                } else {
                    showMessage("KullanÄ±cÄ± adÄ± 3-20 karakter arasÄ±nda olmalÄ±.", 'red');
                }
            });

            document.getElementById('upgrade-speed-button').addEventListener('click', () => 
                performUpgrade(getSpeedCost, 'speedLevel', 'Madenci HÄ±zÄ±', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-count-button').addEventListener('click', () => 
                performUpgrade(getCountCost, 'minerCountLevel', 'Madenci SayÄ±sÄ±', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-depth-button').addEventListener('click', () => 
                performUpgrade(getDepthCost, 'shaftDepthLevel', 'Maden DerinliÄŸi', MAX_UPGRADE_LEVEL));
            document.getElementById('upgrade-capacity-button').addEventListener('click', () => 
                performUpgrade(getCapacityCost, 'elevatorCapacityLevel', 'AsansÃ¶r Kapasitesi', MAX_UPGRADE_LEVEL));
            document.getElementById('level-up-button').addEventListener('click', () => 
                performUpgrade(getLevelCost, 'level', 'Level', MAX_LEVEL));
            
            document.getElementById('close-offline-modal').addEventListener('click', () => {
                document.getElementById('offline-modal').style.display = 'none';
            });
            
            // Victory / Reset Listeners
            document.getElementById('victory-reset-button').addEventListener('click', publicResetData);
            document.getElementById('close-victory-modal').addEventListener('click', () => {
                document.getElementById('victory-modal').style.display = 'none';
            });
            document.getElementById('public-reset-button').addEventListener('click', showVictoryModal);
            
            // Normal Reset Button (Footer)
            document.getElementById('hard-reset-btn').addEventListener('click', () => {
                 const confirmation = prompt('Oyunu tamamen sÄ±fÄ±rlamak iÃ§in "SÄ±fÄ±rla" yaz. (Bu iÅŸlem geri alÄ±namaz ve tÃ¼m ilerlemeyi siler!)');
                 if(confirmation === 'SÄ±fÄ±rla') {
                     resetGameLogic();
                 }
            });

            // Admin ButonlarÄ±
            document.getElementById('admin-button').addEventListener('click', showAdminModal);
            document.getElementById('admin-login-button').addEventListener('click', adminLogin);
            
            document.getElementById('apply-cheat-button').addEventListener('click', () => {
                const code = document.getElementById('cheat-code-input').value.trim().toUpperCase();
                const cheat = RAINBOW_CODES[code];
                if (cheat) {
                    cheat.fn();
                    showMessage(`[Hile Aktif] ${cheat.message}`, 'yellow');
                } else {
                    showMessage(`Hile Kodu GeÃ§ersiz!`, 'red');
                }
                document.getElementById('cheat-code-input').value = '';
                updateUI();
                renderMarketItems(); 
                saveGameData();
            });
            
            document.getElementById('cheat-code-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('apply-cheat-button').click();
                }
            });

            document.getElementById('admin-cheat-money').addEventListener('click', adminCheatMoney);
            document.getElementById('admin-cheat-max-all').addEventListener('click', adminCheatMaxAll);
            document.getElementById('admin-cheat-unlock-market').addEventListener('click', adminCheatUnlockMarket);
            document.getElementById('admin-reset-data').addEventListener('click', adminResetData);
            document.getElementById('admin-close').addEventListener('click', () => {
                document.getElementById('admin-modal').style.display = 'none';
            });
        });
    </script>
</body>
</html>

